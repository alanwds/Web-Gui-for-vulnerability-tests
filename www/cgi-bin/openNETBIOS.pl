#!/usr/bin/perl

#Scrip para testar se determinado servidor netbios esta aberto para a internet
#O script recebe como parametro um IP a ser testado e retorna 0 para servidor OK, 1 para servidor vulneravel (Neste caso, ele captura tambem a mensagem que consegui obter) ou 2 para algum erro + mensagem de erro
#ATENCAO, o retorno da flag deve ser procedido de uma outra flag para separar o resultado da mensagem que o script retorna. Exemplo: 0&message, 1&anotherMessage etc..

#Autor: alanwds@gmail.com

#Declaracao de variavels
my $netBiosServerToCheck = 0;
my $debug = 0;
my $timeout = 2;

#Chega o envio do parametro
#Se tiver sem parametro, exibe help
#Se tiver com parametro, ele atrbiui o parametro a variavel dnsServerToCheck
#Nao existe naitizacao dos dados aqui, pois presume-se que os dados ja foram sanitizados no script "MASTER"

if (!$ARGV[0]){

print "ERRO: Modo de usar:
        \n ./openNETBIOS [IP]
\n[IP] - Endereco do servidor NETBIOS a ser testado\n";
exit 0;
}else{

        $netBiosServerToCheck = $ARGV[0];

}


use Net::NBName;
my $nb = Net::NBName->new;

#Consulta a tabela de nomes netbios
my $ns = $nb->node_status($netBiosServerToCheck, $timeout);

#Se existe retorno da consulta efetuada acima, havera a impressao da flag 1 (vulneravel) e da tabela
	if ($ns) {
		print "1&";	
      		print $ns->as_string;
	}else{ #caso contratio, ira imprimir 0, pois o servidor esta ok
		print "0&";
	}
